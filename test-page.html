<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIå½•åˆ¶æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .loading {
            display: none;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <h1>Chromeæ‰©å±•APIå½•åˆ¶åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“¡ HTTPè¯·æ±‚æµ‹è¯•</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å‘é€ä¸åŒç±»å‹çš„HTTPè¯·æ±‚ï¼Œæµ‹è¯•APIå½•åˆ¶åŠŸèƒ½ï¼š</p>
        
        <button onclick="testGETRequest()">GETè¯·æ±‚æµ‹è¯•</button>
        <button onclick="testPOSTRequest()">POSTè¯·æ±‚æµ‹è¯•</button>
        <button onclick="testPUTRequest()">PUTè¯·æ±‚æµ‹è¯•</button>
        <button onclick="testDELETERequest()">DELETEè¯·æ±‚æµ‹è¯•</button>
        <button onclick="testJSONPRequest()">JSONPè¯·æ±‚æµ‹è¯•</button>
        
        <div class="loading" id="loading">å‘é€è¯·æ±‚ä¸­...</div>
        <div class="results" id="results">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”„ æ‰¹é‡è¯·æ±‚æµ‹è¯•</h2>
        <p>æµ‹è¯•å¤§é‡å¹¶å‘è¯·æ±‚çš„å½•åˆ¶èƒ½åŠ›ï¼š</p>
        
        <button onclick="testBatchRequests()">å‘é€10ä¸ªå¹¶å‘è¯·æ±‚</button>
        <button onclick="testSequentialRequests()">å‘é€5ä¸ªé¡ºåºè¯·æ±‚</button>
        <button onclick="testMixedRequests()">æ··åˆè¯·æ±‚ç±»å‹æµ‹è¯•</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ¯ ç‰¹æ®Šåœºæ™¯æµ‹è¯•</h2>
        <p>æµ‹è¯•ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯·æ±‚å½•åˆ¶ï¼š</p>
        
        <button onclick="testCORSRequest()">è·¨åŸŸè¯·æ±‚æµ‹è¯•</button>
        <button onclick="testErrorRequest()">é”™è¯¯è¯·æ±‚æµ‹è¯•</button>
        <button onclick="testLargePayload()">å¤§æ•°æ®è½½è·æµ‹è¯•</button>
        <button onclick="testFileUpload()">æ–‡ä»¶ä¸Šä¼ æ¨¡æ‹Ÿ</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ› ï¸ æ‰©å±•æ§åˆ¶</h2>
        <p>æµ‹è¯•æ‰©å±•çš„æ§åˆ¶åŠŸèƒ½ï¼š</p>
        
        <button onclick="startRecording()">å¼€å§‹å½•åˆ¶</button>
        <button onclick="stopRecording()">åœæ­¢å½•åˆ¶</button>
        <button onclick="getState()">è·å–çŠ¶æ€</button>
        <button onclick="clearRecords()">æ¸…ç©ºè®°å½•</button>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        const loadingDiv = document.getElementById('loading');
        
        function showLoading() {
            loadingDiv.style.display = 'block';
        }
        
        function hideLoading() {
            loadingDiv.style.display = 'none';
        }
        
        function appendResult(message) {
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.textContent += `[${timestamp}] ${message}\n`;
        }
        
        function clearResults() {
            resultsDiv.textContent = '';
        }
        
        // åŸºç¡€APIè¯·æ±‚æµ‹è¯•
        async function testGETRequest() {
            showLoading();
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
                const data = await response.json();
                appendResult(`GETè¯·æ±‚æˆåŠŸ: ${response.status} - ${data.title}`);
            } catch (error) {
                appendResult(`GETè¯·æ±‚å¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        async function testPOSTRequest() {
            showLoading();
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer test-token-123'
                    },
                    body: JSON.stringify({
                        title: 'APIå½•åˆ¶æµ‹è¯•',
                        body: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•POSTè¯·æ±‚',
                        userId: 1
                    })
                });
                const data = await response.json();
                appendResult(`POSTè¯·æ±‚æˆåŠŸ: ${response.status} - ID: ${data.id}`);
            } catch (error) {
                appendResult(`POSTè¯·æ±‚å¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        async function testPUTRequest() {
            showLoading();
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: 1,
                        title: 'æ›´æ–°çš„æ ‡é¢˜',
                        body: 'æ›´æ–°çš„å†…å®¹',
                        userId: 1
                    })
                });
                const data = await response.json();
                appendResult(`PUTè¯·æ±‚æˆåŠŸ: ${response.status} - ${data.title}`);
            } catch (error) {
                appendResult(`PUTè¯·æ±‚å¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        async function testDELETERequest() {
            showLoading();
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1', {
                    method: 'DELETE'
                });
                appendResult(`DELETEè¯·æ±‚æˆåŠŸ: ${response.status}`);
            } catch (error) {
                appendResult(`DELETEè¯·æ±‚å¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        function testJSONPRequest() {
            showLoading();
            const script = document.createElement('script');
            script.src = 'https://api.github.com/users/octocat?callback=handleJSONP';
            
            window.handleJSONP = function(data) {
                appendResult(`JSONPè¯·æ±‚æˆåŠŸ: ${data.data.login} - ${data.data.public_repos} ä¸ªä»“åº“`);
                document.head.removeChild(script);
                delete window.handleJSONP;
                hideLoading();
            };
            
            script.onerror = function() {
                appendResult('JSONPè¯·æ±‚å¤±è´¥');
                hideLoading();
            };
            
            document.head.appendChild(script);
        }
        
        // æ‰¹é‡è¯·æ±‚æµ‹è¯•
        async function testBatchRequests() {
            showLoading();
            appendResult('å¼€å§‹å‘é€10ä¸ªå¹¶å‘è¯·æ±‚...');
            
            const promises = [];
            for (let i = 1; i <= 10; i++) {
                promises.push(
                    fetch(`https://jsonplaceholder.typicode.com/posts/${i}`)
                        .then(response => response.json())
                );
            }
            
            try {
                const results = await Promise.all(promises);
                appendResult(`å¹¶å‘è¯·æ±‚å®Œæˆ: æˆåŠŸè·å– ${results.length} ä¸ªå“åº”`);
            } catch (error) {
                appendResult(`å¹¶å‘è¯·æ±‚å¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        async function testSequentialRequests() {
            showLoading();
            appendResult('å¼€å§‹å‘é€5ä¸ªé¡ºåºè¯·æ±‚...');
            
            try {
                for (let i = 1; i <= 5; i++) {
                    const response = await fetch(`https://jsonplaceholder.typicode.com/posts/${i}`);
                    const data = await response.json();
                    appendResult(`é¡ºåºè¯·æ±‚ ${i}/5: ${data.title}`);
                    await new Promise(resolve => setTimeout(resolve, 500)); // å»¶è¿Ÿ500ms
                }
                appendResult('é¡ºåºè¯·æ±‚å…¨éƒ¨å®Œæˆ');
            } catch (error) {
                appendResult(`é¡ºåºè¯·æ±‚å¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        async function testMixedRequests() {
            showLoading();
            appendResult('å¼€å§‹æ··åˆè¯·æ±‚ç±»å‹æµ‹è¯•...');
            
            try {
                // GET
                await fetch('https://jsonplaceholder.typicode.com/posts/1');
                appendResult('æ··åˆæµ‹è¯•: GETè¯·æ±‚å®Œæˆ');
                
                // POST
                await fetch('https://jsonplaceholder.typicode.com/posts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: 'Test', body: 'Test body' })
                });
                appendResult('æ··åˆæµ‹è¯•: POSTè¯·æ±‚å®Œæˆ');
                
                // PUT
                await fetch('https://jsonplaceholder.typicode.com/posts/1', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: 1, title: 'Updated' })
                });
                appendResult('æ··åˆæµ‹è¯•: PUTè¯·æ±‚å®Œæˆ');
                
                appendResult('æ··åˆè¯·æ±‚æµ‹è¯•å…¨éƒ¨å®Œæˆ');
            } catch (error) {
                appendResult(`æ··åˆè¯·æ±‚æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        // ç‰¹æ®Šåœºæ™¯æµ‹è¯•
        async function testCORSRequest() {
            showLoading();
            try {
                // å°è¯•ä¸€ä¸ªå¯èƒ½è§¦å‘CORSçš„è¯·æ±‚
                const response = await fetch('https://api.github.com/repos/microsoft/vscode', {
                    headers: {
                        'X-Custom-Header': 'test'
                    }
                });
                const data = await response.json();
                appendResult(`CORSè¯·æ±‚æˆåŠŸ: ${data.name} - ${data.stargazers_count} stars`);
            } catch (error) {
                appendResult(`CORSè¯·æ±‚å¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        async function testErrorRequest() {
            showLoading();
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/999999');
                appendResult(`é”™è¯¯è¯·æ±‚å“åº”: ${response.status} ${response.statusText}`);
            } catch (error) {
                appendResult(`é”™è¯¯è¯·æ±‚å¼‚å¸¸: ${error.message}`);
            }
            hideLoading();
        }
        
        async function testLargePayload() {
            showLoading();
            try {
                // åˆ›å»ºä¸€ä¸ªå¤§çš„æ•°æ®è½½è·
                const largeData = {
                    title: 'Large Payload Test',
                    content: 'x'.repeat(10000), // 10KBçš„æ•°æ®
                    metadata: {
                        timestamp: Date.now(),
                        version: '1.0.0',
                        tags: Array.from({length: 100}, (_, i) => `tag-${i}`)
                    }
                };
                
                const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(largeData)
                });
                
                appendResult(`å¤§è½½è·è¯·æ±‚å®Œæˆ: ${response.status} - æ•°æ®å¤§å°: ${JSON.stringify(largeData).length} å­—èŠ‚`);
            } catch (error) {
                appendResult(`å¤§è½½è·è¯·æ±‚å¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        async function testFileUpload() {
            showLoading();
            try {
                // æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ 
                const formData = new FormData();
                formData.append('file', new Blob(['è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶å†…å®¹'], {type: 'text/plain'}), 'test.txt');
                formData.append('description', 'æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ');
                
                const response = await fetch('https://httpbin.org/post', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                appendResult(`æ–‡ä»¶ä¸Šä¼ æ¨¡æ‹ŸæˆåŠŸ: ${response.status} - è¡¨å•å­—æ®µ: ${Object.keys(data.form || {}).length}`);
            } catch (error) {
                appendResult(`æ–‡ä»¶ä¸Šä¼ æ¨¡æ‹Ÿå¤±è´¥: ${error.message}`);
            }
            hideLoading();
        }
        
        // æ‰©å±•æ§åˆ¶åŠŸèƒ½
        async function startRecording() {
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    const response = await chrome.runtime.sendMessage({ type: 'START_RECORDING' });
                    appendResult(`å¼€å§‹å½•åˆ¶: ${response.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
                } else {
                    appendResult('å¼€å§‹å½•åˆ¶: æœªæ£€æµ‹åˆ°Chromeæ‰©å±•ç¯å¢ƒ');
                }
            } catch (error) {
                appendResult(`å¼€å§‹å½•åˆ¶å¤±è´¥: ${error.message}`);
            }
        }
        
        async function stopRecording() {
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    const response = await chrome.runtime.sendMessage({ type: 'STOP_RECORDING' });
                    appendResult(`åœæ­¢å½•åˆ¶: ${response.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
                } else {
                    appendResult('åœæ­¢å½•åˆ¶: æœªæ£€æµ‹åˆ°Chromeæ‰©å±•ç¯å¢ƒ');
                }
            } catch (error) {
                appendResult(`åœæ­¢å½•åˆ¶å¤±è´¥: ${error.message}`);
            }
        }
        
        async function getState() {
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    const response = await chrome.runtime.sendMessage({ type: 'GET_STATE' });
                    if (response.success) {
                        const state = response.state;
                        appendResult(`å½•åˆ¶çŠ¶æ€: ${state.isRecording ? 'å½•åˆ¶ä¸­' : 'æœªå½•åˆ¶'} - è®°å½•æ•°: ${state.recordCount}`);
                    } else {
                        appendResult('è·å–çŠ¶æ€å¤±è´¥');
                    }
                } else {
                    appendResult('è·å–çŠ¶æ€: æœªæ£€æµ‹åˆ°Chromeæ‰©å±•ç¯å¢ƒ');
                }
            } catch (error) {
                appendResult(`è·å–çŠ¶æ€å¤±è´¥: ${error.message}`);
            }
        }
        
        async function clearRecords() {
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    const response = await chrome.runtime.sendMessage({ type: 'CLEAR_RECORDS' });
                    appendResult(`æ¸…ç©ºè®°å½•: ${response.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
                } else {
                    appendResult('æ¸…ç©ºè®°å½•: æœªæ£€æµ‹åˆ°Chromeæ‰©å±•ç¯å¢ƒ');
                }
            } catch (error) {
                appendResult(`æ¸…ç©ºè®°å½•å¤±è´¥: ${error.message}`);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            appendResult('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // æ£€æŸ¥æ‰©å±•ç¯å¢ƒ
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                appendResult('æ£€æµ‹åˆ°Chromeæ‰©å±•ç¯å¢ƒ âœ“');
                getState(); // è‡ªåŠ¨è·å–åˆå§‹çŠ¶æ€
            } else {
                appendResult('æœªæ£€æµ‹åˆ°Chromeæ‰©å±•ç¯å¢ƒ - è¯·ç¡®ä¿æ‰©å±•å·²å®‰è£…å¹¶å¯ç”¨');
            }
        });
    </script>
</body>
</html>